#오퍼레이팅 시스템 프로젝트 상위 설계서

* 프로젝트 주제 : 웹 스트리밍 플레이어
* 프로젝트 이름 : 웹 뮤직 플레이어

####조원
* 윤원섭
* 이성원
* 이영조
* 양형규



##구조
웹 뮤직 플레이어의 개발 파트는 크게 "서버 프로그래밍", "클라이언트 프로그래밍", "웹 디자인"으로 나뉜다.


##서버 프로그래밍
서버 프로그래밍은 주로 Python언어로 개발되며, Micro Web Framwork 중 하나인 Flask를 중점으로 개발한다.


###Flask
Flask는 Python 기반의 Web Microframwork이다. MVC (Model View Controller) 패턴을 잘 지원하며 최소한의 기능만을 가지는 간결한 구조로 이루어져 있다. 부족한 기능은 확장기능으로 추가 가능하다.

###Jinja2
Jinja2는 Python 기반의 Template Engine이다. 서버에서 처리한 결과를 HTML 규격으로 제작하는데 목적이 있다. MVC 중 V에 해당한다.

Jnja2는 Jinja2 만의 Python과 유사한 독특한 언어를 사용한다.


###SQLAlchemly
SQLAlcehmy는 Python 기반의 Object Relational Mapper이다. SQL 구문을 객체지향적으로 만들 수 있으며 복잡한 쿼리도 쉽게 제작할 수 있다. 뿐만 아니라 SQL Injection 등의 보안 위협으로부터 안전하다.


###Libav/FFMPEG
Libav 혹은 FFMPEG는 rtmp 스트림을 만들기 위해서는 오디오파일 (mp3, m4a) 등을 AAC/flv 규격으로 인코딩하기 위해 사용하는 디코더/인코더이다. 

Libav/FFMPEG는 Gstreamer를 통해 제어하거나 Python 플러그인을 통해 제어한다.


###Gstreamer
Libav/FFMPEG를 쉽게 제어하고 rtmp 스트림을 제작하기 위한 멀티미디어 프레임워크이다.

Gstreamer는 Python 플러그인으로 제어하거나, 명령행 스트링으로 제어한다.

만들어진 스트림은 nginx 플러그인인 nginx-rtmp-module을 이용해 스트리밍 된다.



##클라이언트 프로그래밍

###Javascript (jQuery)
자바스크립트는 클라이언트 프로그램의 주된 프로그래밍 언어이다. 대부분의 기능은 자바스크립트로 구현한다. 또한, DOM 제어와 AJAX 제어를 위해 jQuery를 사용한다.

####AJAX
AJAX기법은 jQuery를 이용해 사용되며 JSON 규격으로 데이터를 송수신한다.

###Flash
Flash는 오디오 스트리밍 리시브와 오디오 재생을 위해 사용한다. 내부적으로 rtmp를 사용하며 액션스크립트를 통해 제어한다. 


##웹 디자인
###HTML5
반응형 웹, 멀티미디어 지원 등을 쉽게 구현할 수 있고 웹브라우저에어 기본적으로 지원하는 웹 마크업 언어이다.

###BootStrap3 (CSS)
웹의 각 컴포넌트 (버튼, 메뉴 등)등을 잘 구현한 CSS, Javascript (Plugin) 모음집이다. 기본적으로 반응형 디자인을 지원하며 PC와 모바일 환경 모두 잘 지원한다. 또한, 현재 상용 브라우저 대부분을 지원한다.



##제어의 흐름
엔드유저의 입장에서 데이터와 제어의 흐름을 나타내면 다음과 같다.

###GET 요청 (접속, 페이지 전환)
1. 유저가 웹브라우저를 통해 서버에 HTML 요청을 한다.
2. Flask(서버)는 홈페이지의 환경에 따라 각 모델(변수 등)들을 계산한뒤 Jinja2 템플릿 엔진을 호출한다.
3. Jinja2 템플릿 엔진은 모델을 가지고 HTML을 작성한뒤 Flask에게 되돌려준다.
4. 만들어진 HTML을 웹브라우저에게 보낸다.

###로그인
1. 로그인 페이지를 GET 요청 한다.
2. 로그인 폼에 정보를 입력한 뒤 정보를 POST 요청한다.
3. 서버에서 SQLAlchemy를 이용해 로그인 정보를 DB와 비교한다.
4. 결과에 따른 정보를 웹브라우저로 보낸다.

###음악 재생
1. 음악 페이지를 GET 요청한다.
2. 음악 페이지에서 원하는 노래를 선택하면  서버에 AJAX요청을 보낸다.
3. AJAX요청 (JSON 형식)을 파싱한 뒤, DB에서 음악과 관련한 정보를 찾는다.
4. 찾은 정보로 파일 시스템의 음악을 찾는다.
5. 음악 파일을 Libav/FFMPEG를 이용해 AAC/flv 규격으로 인코딩한다.
6. 인코딩된 파일을 Gstreamer를 이용해 rtmp 스트림을 만든다. (rtmp 스트림은 nginx-rtmp-module 설정에 따라 저장한다.)
7. AJAX를 통해 실행 결과를 웹브라우저로 반환한다.
8. AJAX 리턴값을 이용해 Flash 오브젝트에 rtmp 스트림 정보를 넘겨준다.
9. 플래시 오브젝트가 rtmp 스트림을 재생한다.


##개발환경

###웹서버
* Ubuntu 14.04 LTS Server (Hyper-V Virtual Server)
* nginx + FastCGI (Flask) + nginx-rtmp-module
* MariaDB 10.0

###클라이언트
* 웹브라우저 : Firefox, Chrome, Internet Explorer, Safari 최신버전
* 모바일 웹 브라우저 : Android Browser, Chrome (With Flash Plugin)

##플로차트
![flowchart](https://raw.githubusercontent.com/Pusnow/OSWebMusicPlayer/master/doc/flowchart.jpg?token=AFwGqQV1KDx4C5L_QMVWKIghsqtZaDHIks5UVLPHwA%3D%3D)


